<div class="row" style="margin-top: 20px">
	<div class="col-lg-2">
    <div class="block">
	    <ul class="nav nav-list">
				<li class="nav-header">Nhóm <i class="icon-accessibility"></i></li>
				<% if(groups.length >0) { %>
					<script>var groups = []</script>
					<% for(var i = 0; i < groups.length; i++) { %>
						<li>
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><%= groups[i]['name'] %><span class="label label-danger"><%= groups[i]['exams'].length %></span></a>
							<ul class="dropdown-menu icons-right dropdown-menu-right">
								<li><a href="#"><i class="icon-exit"></i> Rời nhóm</a></li>
							</ul>
							<script>groups.push('<%= groups[i]['_id'] %>')</script>
						</li>
					<% } %>
				<% } else { %>
						<li><p>Chưa tham gia nhóm nào.</p></li>
				<% } %>
				<li><button type="button" data-action="join-group" class="btn btn-block btn-info">Tham gia nhóm</button></li>
			</ul>
		</div>
	</div>

	<div class="col-lg-10">
    <div class="tabbable page-tabs">
      <ul class="nav nav-pills nav-justified">
        <li class="active"><a href="#activity" data-toggle="tab"><i class="icon-marker"></i> Hoạt động</a></li>
        <li><a href="#groups" data-toggle="tab"><i class="icon-users"></i> Nhóm</a></li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="activity">
					<div class="block">
            <div class="datatable-tasks">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Bài kiểm tra</th>
                    <th class="task-priority">Nhóm</th>
                    <th class="task-date-added">Ngày làm</th>
                    <th class="task-progress">Hoàn thành</th>
                    <th class="task-deadline">Thời hạn</th>
                    <th class="task-tools text-center">Chức năng</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="task-desc">
                    	<a href="task_detailed.html">Donec suscipit ultrices commodo. Suspendisse potenti</a>
                    	<span>General layout additions</span>
                    </td>
                    <td class="text-center">
                    	<span class="label label-danger">Ôn thi ĐH</span>
                    </td>
                    <td>September 20, 2013</td>
                    <td>
                      <div class="progress progress-micro">
												<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width: 90%;">
													<span class="sr-only">90% Complete</span>
												</div>
											</div>
                    </td>
                    <td><i class="icon-clock"></i> <strong class="text-danger">14</strong> hours left</td>
	                  <td class="text-center">
	                    <div class="btn-group">
		                    <button type="button" class="btn btn-icon btn-success dropdown-toggle" data-toggle="dropdown"><i class="icon-cog4"></i></button>
												<ul class="dropdown-menu icons-right dropdown-menu-right">
													<li><a href="#"><i class="icon-quill2"></i> Làm lại</a></li>
													<li><a href="#"><i class="icon-stack"></i> Lịch sử</a></li>
												</ul>
	                    </div>
	                  </td>
                  </tr>
                  <tr>
                    <td class="task-desc">
                    	<a href="task_detailed.html">Nunc tincidunt consectetur quam et venenatis</a>
                    	<span>HTML / CSS changes</span>
                    </td>
                    <td class="text-center">
                    	<span class="label label-danger">Ôn thi ĐH</span>
                    </td>
                    <td>April 19, 2013</td>
                    <td>
                      <div class="progress progress-micro">
												<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">
													<span class="sr-only">100% Complete</span>
												</div>
											</div>
                    </td>
                    <td><i class="icon-clock"></i> <strong>Complete!</strong></td>
                    <td class="text-center">
                      <div class="btn-group">
	                      <button type="button" class="btn btn-icon btn-success dropdown-toggle" data-toggle="dropdown"><i class="icon-cog4"></i></button>
												<ul class="dropdown-menu icons-right dropdown-menu-right">
													<li><a href="#"><i class="icon-quill2"></i> Làm lại</a></li>
													<li><a href="#"><i class="icon-stack"></i> Lịch sử</a></li>
												</ul>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="groups">
					<div class="block">
						<h6><i class="icon-users"></i> Nhóm</h6>
	        	<ul class="message-list">
	        		<% if(groups.length >0) { %>
								<% for(var i = 0; i < groups.length; i++) { %>
									<li class="message-list-header"><%= groups[i]['name'] %></li>
									<!-- <li>
			              <div class="clearfix">
			                <div class="chat-member">
												<h6>Thi thử lần 1 <span class="status status-success"></span> <small>&nbsp; /&nbsp; Toán 12, Toán 11</small></h6>
											</div>
											<div class="chat-actions">
												<a href="#" class="btn btn-link btn-icon btn-xs"><i class="icon-marker"></i></a>
												<a class="btn btn-link btn-icon btn-xs" data-toggle="collapse" href="#eugene_kopyov"><i class="icon-bubble3"></i></a>
											</div>
			              </div>

			              <div class="panel-collapse collapse" id="eugene_kopyov">
											<h1>Chat Facebook</h1>
			              </div>
			        		</li> -->
			        		 <% } %>
							<% } %>	
	        	</ul>
		    	</div>
        </div>
      </div>
    </div>
	</div>
	<script async>
		$('[data-action]').on('click', function(e) {
			e.preventDefault();
			var action = $(this).data('action');
			if (action === 'join-group') {
				swal({
				  title: "Nhóm !",
				  type: "input",
				  showCancelButton: true,
				  closeOnConfirm: false,
				  confirmButtonText: "Tham gia",
		  		cancelButtonText: "Hủy",
				  showLoaderOnConfirm: true,
				  animation: "slide-from-top",
				  inputPlaceholder: "Nhập tên nhóm.."
				},
				function(inputValue){
				  if (inputValue === false) return false;
				  
				  if (inputValue === "") {
				    swal.showInputError("Tên nhóm không được bỏ trống!");
				    return false
				  }
				  $.post('/manager/group-join', {name: inputValue}, function(res) {
				  	if(res.ok) {
				  		swal.showInputSuccess('Yêu cầu tham gia nhóm '+inputValue+' đã được gửi');
				  	} else {
				  		swal.showInputError(res.error);
				    	return false
				  	}
				  })
				})
			};
			if (action === 'users-group') {
				$.post('/manager/group-users', {id: $(this).data('group')}, function(res) {
			  	if(res.ok) {
			  		swal("Thành công!", "Nhóm " + inputValue+" đã được tạo", "success");
			  	} else {
			    	return false
			  	}
			  })
			};
			if (action === 'delete-group') {

			}
		});

		$('a[href="#groups"]').on('click', function(e) {
			$.post('/group-list-exam', {groups: groups}, function(res){
				if(res.ok) {
					var exams = res.exams;
					var list = $('#groups ul');
					for (var i = 0; i < exams.length; i++) {
						if (exams[i].exams.length > 0) {
							var arr = exams[i].exams, html= '';
							for (var j = 0; j < arr.length; j++) {
								html += '<li> <div class="clearfix"> <div class="chat-member"> <h6>'+arr[j].name+'<span class="status status-success"></span> </h6> </div> <div class="chat-actions"> <a href="/test/'+arr[j].link+'" class="btn btn-link btn-icon btn-xs" target="_blank"><i class="icon-marker"></i></a> <a class="btn btn-link btn-icon btn-xs" data-toggle="collapse" href="#'+arr[j].link+'"><i class="icon-bubble3"></i></a> </div> </div> <div class="panel-collapse collapse" id="'+arr[j].link+'"> <h1>Chat Facebook</h1> </div> </li>';
							}
							$(html).insertAfter(list.find('li:eq('+i+')'))
						}
					}
					console.log(res.exams)
				}
			})
		})
	</script>
</div>